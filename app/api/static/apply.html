<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGENTR 무료 체험 신청</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
  <style>
    body { font-family: "Pretendard", sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <main class="mx-auto max-w-xl px-4 py-16 sm:px-6 lg:px-8">
    <a href="/static/homepage.html" class="inline-flex items-center text-sm text-slate-300 hover:text-white">← 홈페이지로 돌아가기</a>

    <section class="mt-6 rounded-3xl border border-slate-800 bg-slate-900/80 p-8 shadow-2xl backdrop-blur">
      <h1 class="text-3xl font-extrabold tracking-tight">AGENTR 무료 체험 신청</h1>
      <p id="planText" class="mt-3 text-slate-300">14일 무료 체험을 위해 이메일을 남겨주세요.</p>

      <form id="leadForm" class="mt-8 space-y-4">
        <div>
          <label for="email" class="mb-2 block text-sm font-medium text-slate-200">이메일</label>
          <input
            id="email"
            name="email"
            type="email"
            required
            placeholder="you@company.com"
            class="w-full rounded-xl border border-slate-700 bg-slate-950 px-4 py-3 text-slate-100 outline-none ring-indigo-500 placeholder:text-slate-500 focus:ring-2"
          />
        </div>
        <button
          type="submit"
          class="w-full rounded-xl bg-indigo-600 px-4 py-3 text-base font-bold text-white hover:bg-indigo-500"
        >
          신청 접수하기
        </button>
      </form>

      <div id="resultBox" class="mt-4 hidden rounded-xl border px-4 py-3 text-sm"></div>
      <p class="mt-5 text-xs text-slate-400">신청 시 AGENTR 도입 안내 메일을 보내드립니다.</p>
    </section>
  </main>

  <script>
    const form = document.getElementById("leadForm");
    const resultBox = document.getElementById("resultBox");
    const planText = document.getElementById("planText");
    const baseUrl = window.location.origin;

    const params = new URLSearchParams(window.location.search);
    const plan = (params.get("plan") || "trial").trim().toLowerCase();
    const source = (params.get("source") || "homepage").trim().toLowerCase();

    if (plan === "starter") {
      planText.textContent = "무료 시작하기 신청을 위해 이메일을 남겨주세요.";
    }

    function showResult(ok, message) {
      resultBox.classList.remove("hidden");
      if (ok) {
        resultBox.className = "mt-4 rounded-xl border border-emerald-700 bg-emerald-950/40 px-4 py-3 text-sm text-emerald-300";
      } else {
        resultBox.className = "mt-4 rounded-xl border border-rose-700 bg-rose-950/40 px-4 py-3 text-sm text-rose-300";
      }
      resultBox.textContent = message;
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      const email = String(document.getElementById("email").value || "").trim();
      if (!email) {
        showResult(false, "이메일을 입력해 주세요.");
        return;
      }

      const payload = {
        email,
        source,
        plan,
        metadata: {
          page: "apply",
          user_agent: navigator.userAgent,
        },
      };

      try {
        const response = await fetch(`${baseUrl}/v1/leads/signup`, {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify(payload),
        });
        const body = await response.json();
        if (!response.ok) {
          const detail = body && body.detail ? String(body.detail) : "신청 접수에 실패했습니다.";
          showResult(false, detail);
          return;
        }
        showResult(true, String(body.message || "신청이 접수되었습니다."));
        form.reset();
      } catch (_err) {
        showResult(false, "네트워크 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.");
      }
    });
  </script>
</body>
</html>
